# Events

Often, a simulation requires an instantaneous intervention at a known
point in time. We don't want to interupt simulations and return to R
for simple enough cases.

So, for this purpose, a list of scheduled events can be fed into the
solver.

For a model names `"model"` The transformations can be defined in the c file 

```c
int model_event(double t, double y_[], void *par, int EventLabel, double dose)`
```

So, each transformation event has an integer label with which several alternatives can be selected and a scalar dose which can scale the intensity of the transformation.

We typicaly use the `EventLabel` in a `switch` statement. This
function is auto-generated by the `ode.sh` script in the
[RPN-derivative](icpm-kth/RPN-derivative) repository.

```R
event[[i]] <- list(
   time = c(-1.0,0.0,1.0),
  label = c(   0,  0,  0),
   dose = c(0.01,1.0,10.)
)
```

where at time `time[j]` both the state (and the parameters)
can be transformed as indicated by `label`.

## Note: old event mechanism

We initially implemented a more rudimentary event system, where the
event transformations needed to be linear (affine). Thus, no
`model_event()` function was needed as the user needed to supply the
coefficient matrices instead of a function.

But, since then, we implemented an code-generation script (`ode.sh`)
in RPN-derivative. The approach defined above is much more practical
and versatile.

The old event system still exists for the time being, for compatibility.
